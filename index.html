<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼è¡Œç¨‹è¦åŠƒ</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«”ä»¥ç²å¾—æ›´ç¾ä»£çš„å¤–è§€ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* æ·ºè—è‰²èƒŒæ™¯ */
        }
        .container-card {
            max-width: 800px; 
            margin: 2rem auto;
            padding: 2.5rem;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.15);
        }
        /* ç¾åŒ–æ»¾å‹•æ¢ä»¥åŒ¹é…ä¸»é¡Œ */
        #itinerary-list-container::-webkit-scrollbar {
            width: 8px;
        }
        #itinerary-list-container::-webkit-scrollbar-thumb {
            background-color: #a78bfa; /* ç´«è‰²-400 */
            border-radius: 4px;
        }
        #itinerary-list-container::-webkit-scrollbar-track {
            background-color: #e5e7eb; /* ç°è‰²-200 */
        }
    </style>
</head>
<body>

    <div class="container-card">
        <h1 class="text-4xl font-extrabold text-center mb-8 text-gray-900">
            æ‚¨çš„äº’å‹•å¼è¡Œç¨‹è¨ˆåŠƒ
        </h1>
        
        <!-- æ–°å¢è¡Œç¨‹å€å¡Š -->
        <div class="space-y-4 mb-8 p-4 bg-purple-50 rounded-xl border border-purple-200">
            <h2 class="text-xl font-bold text-purple-700">æ–°å¢è¡Œç¨‹æ´»å‹•</h2>
            
            <div class="grid grid-cols-2 gap-4">
                <!-- æ—¥æœŸèˆ‡æ™‚é–“ -->
                <input type="date" id="new-itinerary-date" 
                       class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                <input type="time" id="new-itinerary-time" 
                       class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <!-- åœ°é»/é€£çµ -->
            <input type="text" id="new-itinerary-location" placeholder="è¼¸å…¥åœ°é»æˆ–åœ°åœ–é€£çµ (ä¾‹å¦‚ï¼šå°åŒ— 101, Google Maps é€£çµ)"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">

            <!-- è¡Œç¨‹å…§å®¹ -->
            <div class="flex space-x-2">
                <input type="text" id="new-itinerary-text" placeholder="è¡Œç¨‹æ´»å‹•æè¿° (ä¾‹å¦‚ï¼šäº«ç”¨åˆé¤ä¸¦è§€è³ç¾æ™¯)"
                       class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                
                <button id="add-itinerary-btn" 
                        class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl transition duration-200 ease-in-out shadow-lg hover:shadow-xl transform hover:scale-[1.02]">
                    <svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    æ–°å¢
                </button>
            </div>
        </div>

        <!-- è¡Œç¨‹æ¸…å–®å€å¡Š -->
        <div id="itinerary-list-container" class="space-y-6 max-h-[60vh] overflow-y-auto p-2">
            <p class="text-center text-gray-500 p-4" id="loading-message">è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</p>
        </div>

        <div class="mt-8 text-xs text-center p-3 rounded-xl bg-gray-100 text-gray-600">
            * æ‚¨çš„æ‰€æœ‰è¡Œç¨‹è³‡æ–™éƒ½å®‰å…¨åœ°å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨æœ¬åœ°å„²å­˜ç©ºé–“ (LocalStorage) ä¸­ã€‚
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'interactive_travel_planner_v2';
        const addTodoBtn = document.getElementById('add-itinerary-btn');
        const newTodoTextEl = document.getElementById('new-itinerary-text');
        const newTodoDateEl = document.getElementById('new-itinerary-date');
        const newTodoTimeEl = document.getElementById('new-itinerary-time');
        const newTodoLocationEl = document.getElementById('new-itinerary-location');
        const todoListContainer = document.getElementById('itinerary-list-container');
        const loadingMessageEl = document.getElementById('loading-message');

        // åˆå§‹åŒ–æ—¥æœŸè¼¸å…¥ç‚ºä»Šæ—¥æ—¥æœŸï¼Œæ™‚é–“ç‚ºä¸Šåˆ 09:00
        const today = new Date().toISOString().slice(0, 10);
        newTodoDateEl.value = today;
        newTodoTimeEl.value = '09:00'; 


        // --- 1. å„²å­˜/è¼‰å…¥è³‡æ–™çš„è¼”åŠ©å‡½æ•¸ (ä½¿ç”¨ localStorage) ---

        /**
         * é è¼‰å…¥çš„è¡Œç¨‹æ•¸æ“šï¼ˆé¦™æ¸¯/å²¡å±±/å»£å³¶/å¤§é˜ª 8å¤©éŠï¼‰ã€‚
         * @returns {Array<Object>} é è¨­è¡Œç¨‹é™£åˆ—ã€‚
         */
        function getDefaultItinerary() {
            return [
                // Day 1 (2025-11-27) - å§¬è·¯, ç¥æˆ¶, å²¡å±±
                { id: 1, date: '2025-11-27', time: '00:50', location: 'HKGÂ·é¦™æ¸¯åœ‹éš›æ©Ÿå ´', text: 'å‡ºç™¼å‰å¾€é—œè¥¿åœ‹éš›æ©Ÿå ´ (KIX)', completed: false },
                { id: 2, date: '2025-11-27', time: '06:20', location: 'KIXÂ·é—œè¥¿åœ‹éš›æ©Ÿå ´', text: 'æŠµé”é—œè¥¿åœ‹éš›æ©Ÿå ´', completed: false },
                { id: 3, date: '2025-11-27', time: '08:25', location: 'JRä¸‰å®®ç«™', text: 'äº¤é€šè½‰ä¹˜', completed: false },
                { id: 4, date: '2025-11-27', time: '09:02', location: 'æ–°ç¥æˆ¶', text: 'äº¤é€šè½‰ä¹˜', completed: false },
                { id: 5, date: '2025-11-27', time: '09:53', location: 'å§¬è·¯', text: 'æŠµé”å§¬è·¯ï¼Œæº–å‚™è§€å…‰', completed: false },
                { id: 6, date: '2025-11-27', time: '10:19', location: 'å§¬è·¯åŸ', text: 'åƒè§€ä¸–ç•Œéºç”¢å§¬è·¯åŸ', completed: false },
                { id: 7, date: '2025-11-27', time: '12:05', location: 'å¥½å¤åœ’', text: 'åƒè§€å¥½å¤åœ’æ—¥å¼åº­åœ’', completed: false },
                { id: 8, date: '2025-11-27', time: '12:43', location: 'ç¥æˆ¶ç‰›ä¸²ç‡’ Kushiyaki Kobe beef', text: 'åˆé¤ï¼šå“åšç¥æˆ¶ç‰›ä¸²ç‡’', completed: false },
                { id: 9, date: '2025-11-27', time: '14:39', location: 'ç¾åˆ©å …å…¬åœ’', text: 'åƒè§€ç¾åˆ©å …å…¬åœ’', completed: false },
                { id: 10, date: '2025-11-27', time: '15:21', location: 'ç¥æˆ¶è‡¨æµ·æ¨‚åœ’ umie', text: 'è³¼ç‰©èˆ‡ä¼‘é–’', completed: false },
                { id: 11, date: '2025-11-27', time: '18:07', location: 'JRä¸‰å®®ç«™', text: 'è¿”å›ä¸‰å®®ç«™ï¼Œå‰å¾€å²¡å±±', completed: false },
                { id: 12, date: '2025-11-27', time: '19:10', location: 'VIA INN å²¡å±±', text: 'å…¥ä½é£¯åº—', completed: false },
                { id: 13, date: '2025-11-27', time: '19:41', location: 'æ°¸æ—ºå¤¢æ¨‚åŸ å²¡å±±', text: 'é€›æ°¸æ—ºå¤¢æ¨‚åŸ', completed: false },
                { id: 14, date: '2025-11-27', time: '20:47', location: 'Tan-ya Bizen (Aeon Mall Okayama)', text: 'æ™šé¤ï¼šTan-ya Bizen', completed: false },
                { id: 15, date: '2025-11-27', time: '21:59', location: 'VIA INN å²¡å±±', text: 'å›é£¯åº—ä¼‘æ¯', completed: false },

                // Day 2 (2025-11-28) - å®®å³¶, å»£å³¶
                { id: 16, date: '2025-11-28', time: '06:00', location: 'VIA INN å²¡å±±', text: 'é£¯åº—é€€æˆ¿/å¯„æ”¾è¡Œæï¼Œå‡ºç™¼å‰å¾€å»£å³¶', completed: false },
                { id: 17, date: '2025-11-28', time: '08:30', location: 'å®®å³¶å£', text: 'æŠµé”å®®å³¶å£', completed: false },
                { id: 18, date: '2025-11-28', time: '08:33', location: 'JR Miyajima Ferry', text: 'æ­ä¹˜æ¸¡è¼ªå‰å¾€å®®å³¶', completed: false },
                { id: 19, date: '2025-11-28', time: '09:21', location: 'åš´å³¶ç¥ç¤¾', text: 'åƒè§€åš´å³¶ç¥ç¤¾', completed: false },
                { id: 20, date: '2025-11-28', time: '11:29', location: 'ç´…è‘‰è°·å…¬åœ’', text: 'åƒè§€ç´…è‘‰è°·å…¬åœ’', completed: false },
                { id: 21, date: '2025-11-28', time: '12:47', location: 'JR Miyajima Ferry', text: 'æ­ä¹˜æ¸¡è¼ªè¿”å›å®®å³¶å£', completed: false },
                { id: 22, date: '2025-11-28', time: '13:25', location: 'Takara', text: 'åˆé¤ï¼šTakara', completed: false },
                { id: 23, date: '2025-11-28', time: '14:36', location: 'å»£å³¶å’Œå¹³ç´€å¿µè³‡æ–™é¤¨', text: 'åƒè§€è³‡æ–™é¤¨', completed: false },
                { id: 24, date: '2025-11-28', time: '15:24', location: 'å»£å³¶å’Œå¹³ç´€å¿µå…¬åœ’', text: 'åƒè§€å…¬åœ’', completed: false },
                { id: 25, date: '2025-11-28', time: '15:55', location: 'åŸå­å½ˆçˆ†ç‚¸åœ“é ‚å±‹', text: 'åƒè§€åœ“é ‚å±‹', completed: false },
                { id: 26, date: '2025-11-28', time: '16:24', location: 'å»£å³¶ç´™é¶´å¡”', text: 'åƒè§€ç´™é¶´å¡”', completed: false },
                { id: 27, date: '2025-11-28', time: '17:11', location: 'å»£å³¶åŸ', text: 'åƒè§€å»£å³¶åŸ', completed: false },
                { id: 28, date: '2025-11-28', time: '18:06', location: 'BicCamera å»£å³¶ç«™å‰åº—', text: 'è³¼ç‰©', completed: false },
                { id: 29, date: '2025-11-28', time: '19:31', location: 'åºƒå³¶ç‰¡è £å‡¦ å¤§è¡†é…’å ´ãƒã‚±ãƒ„ ç«‹ç”ºåº—', text: 'æ™šé¤ï¼šå“åšå»£å³¶ç‰¡è £', completed: false },
                { id: 30, date: '2025-11-28', time: '20:54', location: 'å»£å³¶', text: 'å»£å³¶ç«™ï¼Œæº–å‚™è¿”å›å²¡å±±', completed: false },
                { id: 31, date: '2025-11-28', time: '21:51', location: 'VIA INN å²¡å±±', text: 'å›å²¡å±±é£¯åº—ä¼‘æ¯', completed: false },

                // Day 3 (2025-11-29) - å²¡å±±, å€‰æ•·
                { id: 32, date: '2025-11-29', time: '08:00', location: 'VIA INN å²¡å±±', text: 'é£¯åº—æ—©é¤/æº–å‚™å‡ºç™¼', completed: false },
                { id: 33, date: '2025-11-29', time: '09:51', location: 'å‰å‚™æ´¥ç¥ç¤¾', text: 'åƒè§€å‰å‚™æ´¥ç¥ç¤¾', completed: false },
                { id: 34, date: '2025-11-29', time: '10:30', location: 'å‰å‚™æ´¥å½¥ç¥ç¤¾', text: 'åƒè§€å‰å‚™æ´¥å½¥ç¥ç¤¾', completed: false },
                { id: 35, date: '2025-11-29', time: '11:15', location: 'å‰µå‘³é­šèœ å²©æ‰‹å·', text: 'åˆé¤ï¼šå‰µå‘³é­šèœ å²©æ‰‹å·', completed: false },
                { id: 36, date: '2025-11-29', time: '12:18', location: 'é˜¿æ™ºç¥ç¤¾', text: 'åƒè§€é˜¿æ™ºç¥ç¤¾', completed: false },
                { id: 37, date: '2025-11-29', time: '13:25', location: 'å€‰æ•·ç¾è§€åœ°å€', text: 'æ¼«æ­¥å€‰æ•·ç¾è§€åœ°å€', completed: false },
                { id: 38, date: '2025-11-29', time: '14:27', location: 'æœ‰é„°åºµ', text: 'ä¼‘æ¯/é»å¿ƒï¼šæœ‰é„°åºµ', completed: false },
                { id: 39, date: '2025-11-29', time: '15:29', location: 'å€‰æ•·æ¡ƒå­ ç¸½æœ¬åº—', text: 'å“åšå€‰æ•·æ¡ƒå­ç”œé»', completed: false },
                { id: 40, date: '2025-11-29', time: '15:50', location: 'ä¸‰äº•OUTLETå€‰æ•·', text: 'è³¼ç‰©', completed: false },
                { id: 41, date: '2025-11-29', time: '18:16', location: 'å²¡å±±ä¸€ç•ªè¡—', text: 'é€›å²¡å±±ä¸€ç•ªè¡—', completed: false },
                { id: 42, date: '2025-11-29', time: '19:22', location: 'Yakiniku dining Hachiya Honcho shop', text: 'æ™šé¤ï¼šç‡’è‚‰', completed: false },
                { id: 43, date: '2025-11-29', time: '20:26', location: 'é©šå®‰ã®æ®¿å ‚ å”å‰è¨¶å¾· å²¡å±±ç«™å‰åº—', text: 'è³¼ç‰©', completed: false },
                { id: 44, date: '2025-11-29', time: '21:35', location: 'VIA INN å²¡å±±', text: 'å›é£¯åº—ä¼‘æ¯', completed: false },

                // Day 4 (2025-11-30) - å²¡å±±åŸ, å°¾é“
                { id: 45, date: '2025-11-30', time: '08:00', location: 'VIA INN å²¡å±±', text: 'é£¯åº—æ—©é¤/æº–å‚™å‡ºç™¼', completed: false },
                { id: 46, date: '2025-11-30', time: '09:04', location: 'å²¡å±±åŸ', text: 'åƒè§€å²¡å±±åŸ', completed: false },
                { id: 47, date: '2025-11-30', time: '09:40', location: 'å²¡å±±å¾Œæ¨‚åœ’', text: 'åƒè§€æ—¥æœ¬ä¸‰å¤§ååœ’', completed: false },
                { id: 48, date: '2025-11-30', time: '10:37', location: '400â„ƒ PIZZA ãƒ¢ãƒªãƒãƒãƒ (2å·åº—)', text: 'æ—©åˆé¤ï¼šæŠ«è–©', completed: false },
                { id: 49, date: '2025-11-30', time: '12:18', location: 'å°¾é“', text: 'æŠµé”å°¾é“', completed: false },
                { id: 50, date: '2025-11-30', time: '12:32', location: 'é§…å‰å•†åº—è¡— ãŠã®ã¿ã¡', text: 'é€›å•†åº—è¡—', completed: false },
                { id: 51, date: '2025-11-30', time: '12:51', location: 'Uminomieru Park', text: 'æµ·é‚Šå…¬åœ’æ•£æ­¥', completed: false },
                { id: 52, date: '2025-11-30', time: '13:14', location: 'Karasawa Ice Cream', text: 'å“åš Karasawa å†°æ·‡æ·‹', completed: false },
                { id: 53, date: '2025-11-30', time: '13:50', location: 'åƒå…‰å¯ºå±±çºœè»Š å±±éº“ç«™', text: 'æº–å‚™æ­ä¹˜çºœè»Š', completed: false },
                { id: 54, date: '2025-11-30', time: '14:15', location: 'åƒå…‰å¯ºå±±çºœè»Š', text: 'æ­ä¹˜çºœè»Šä¸Šå±±', completed: false },
                { id: 55, date: '2025-11-30', time: '14:16', location: 'åƒå…‰å¯ºå…¬åœ’é ‚ä¸Šå±•æœ›å°', text: 'æ¬£è³é¢¨æ™¯', completed: false },
                { id: 56, date: '2025-11-30', time: '14:50', location: 'åƒå…‰å¯º', text: 'åƒè§€åƒå…‰å¯º', completed: false },
                { id: 57, date: '2025-11-30', time: '15:23', location: 'é¼“å²©', text: 'åƒè§€é¼“å²©', completed: false },
                { id: 58, date: '2025-11-30', time: '16:08', location: 'è²“ä¹‹ç´°é“', text: 'æ¼«æ­¥è²“ä¹‹ç´°é“', completed: false },
                { id: 59, date: '2025-11-30', time: '16:46', location: 'å°¾é“æ‹‰éºµ å£¹ç•ªé¤¨æœ¬åº—', text: 'æ™šé¤ï¼šå“åšå°¾é“æ‹‰éºµ', completed: false },
                { id: 60, date: '2025-11-30', time: '17:57', location: 'æŒå…‰å¯ºå‚é“', text: 'æŒå…‰å¯ºåƒé“æ•£æ­¥', completed: false },
                { id: 61, date: '2025-11-30', time: '18:14', location: 'å°¾é“æœ¬é€šå•†åº—è¡—', text: 'é€›å•†åº—è¡—', completed: false },
                { id: 62, date: '2025-11-30', time: '19:27', location: 'VIA INN å²¡å±±', text: 'å›é£¯åº—ä¼‘æ¯', completed: false },
                
                // Day 5 (2025-12-01) - åµå±±, å¤§é˜ªé›£æ³¢
                { id: 63, date: '2025-12-01', time: '08:00', location: 'VIA INN å²¡å±±', text: 'é€€æˆ¿ï¼Œå‰å¾€æ–°å¤§é˜ª/äº¬éƒ½', completed: false },
                { id: 64, date: '2025-12-01', time: '10:24', location: 'æ–°å¤§é˜ª', text: 'äº¤é€šè½‰ä¹˜', completed: false },
                { id: 65, date: '2025-12-01', time: '11:43', location: 'JRåµ¯å³¨åµå±±ç«™', text: 'æŠµé”åµ¯å³¨åµå±±ç«™', completed: false },
                { id: 66, date: '2025-12-01', time: '11:58', location: 'åµå±±ç«¹æ—å°å¾‘', text: 'åƒè§€ç«¹æ—å°å¾‘', completed: false },
                { id: 67, date: '2025-12-01', time: '13:11', location: 'è•éº¥éºµ åµå±±ã‚ˆã—ã‚€ã‚‰', text: 'åˆé¤ï¼šè•éº¥éºµ', completed: false },
                { id: 68, date: '2025-12-01', time: '14:17', location: 'Wagyu Volcano OAGARI, Arashiyama', text: 'è½‰ä¹˜äº¤é€š', completed: false },
                { id: 69, date: '2025-12-01', time: '14:23', location: 'æ¸¡æœˆæ©‹', text: 'åƒè§€æ¸¡æœˆæ©‹', completed: false },
                { id: 70, date: '2025-12-01', time: '15:59', location: 'äº¬éƒ½å…«å‚ç¥ç¤¾', text: 'åƒè§€å…«å‚ç¥ç¤¾', completed: false },
                { id: 71, date: '2025-12-01', time: '16:52', location: 'äº¬éƒ½ç«™', text: 'å‰å¾€äº¬éƒ½ç«™ï¼Œæº–å‚™å›å¤§é˜ª', completed: false },
                { id: 72, date: '2025-12-01', time: '17:40', location: 'æ–°å¤§é˜ª', text: 'è¿”å›æ–°å¤§é˜ª', completed: false },
                { id: 73, date: '2025-12-01', time: '18:19', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'å…¥ä½é›£æ³¢æ—…é¤¨', completed: false },
                { id: 74, date: '2025-12-01', time: '19:13', location: 'æ¾å³¶æ–°åœ°', text: 'é–’é€› (è¨»: æ­¤åœ°é»è«‹è‡ªè¡Œæ–Ÿé…Œ)', completed: false },
                { id: 75, date: '2025-12-01', time: '20:32', location: 'é“é “å €', text: 'æ™šé¤èˆ‡å¤œæ™¯ï¼šé“é “å €', completed: false },
                { id: 76, date: '2025-12-01', time: '21:35', location: 'å”å‰è¨¶å¾· é“é “å €å¾¡å ‚ç­‹åº—', text: 'è³¼ç‰©', completed: false },
                { id: 77, date: '2025-12-01', time: '22:37', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'å›é£¯åº—ä¼‘æ¯', completed: false },

                // Day 6 (2025-12-02) - å¤§é˜ªè³¼ç‰© (é›£æ³¢, æ¢…ç”°)
                { id: 78, date: '2025-12-02', time: '08:00', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'é£¯åº—æ—©é¤/æº–å‚™å‡ºç™¼', completed: false },
                { id: 79, date: '2025-12-02', time: '10:31', location: 'é«˜å³¶å±‹ å¤§é˜ªåº—', text: 'è³¼ç‰©', completed: false },
                { id: 80, date: '2025-12-02', time: '11:36', location: 'é›£æ³¢ä¸¸äº•', text: 'è³¼ç‰©', completed: false },
                { id: 81, date: '2025-12-02', time: '12:52', location: 'ç¾åœ‹æ‘', text: 'åˆé¤èˆ‡é–’é€›ç¾åœ‹æ‘', completed: false },
                { id: 82, date: '2025-12-02', time: '14:10', location: 'LUCUA 1100', text: 'æ¢…ç”°åœ°å€è³¼ç‰©', completed: false },
                { id: 83, date: '2025-12-02', time: '15:18', location: 'Hankyu Department Store Umeda Main Store', text: 'è³¼ç‰©', completed: false },
                { id: 84, date: '2025-12-02', time: '16:21', location: 'æ–°æ¢…ç”°ç¾é£Ÿè¡—', text: 'å°åƒ/ä¼‘æ†©', completed: false },
                { id: 85, date: '2025-12-02', time: '17:26', location: 'LINKS UMEDA', text: 'è³¼ç‰©', completed: false },
                { id: 86, date: '2025-12-02', time: '18:29', location: 'Luck Rack LINKS UMEDA Store', text: 'è³¼ç‰©', completed: false },
                { id: 87, date: '2025-12-02', time: '19:34', location: 'GRAND FRONT å¤§é˜ª åŒ—é¤¨', text: 'æ™šé¤èˆ‡è³¼ç‰©', completed: false },
                { id: 88, date: '2025-12-02', time: '20:58', location: 'å¿ƒé½‹æ©‹', text: 'å¤œé–“è³¼ç‰©', completed: false },
                { id: 89, date: '2025-12-02', time: '22:13', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'å›é£¯åº—ä¼‘æ¯', completed: false },

                // Day 7 (2025-12-03) - å¤§é˜ªè§€å…‰
                { id: 90, date: '2025-12-03', time: '08:00', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'é£¯åº—æ—©é¤/æº–å‚™å‡ºç™¼', completed: false },
                { id: 91, date: '2025-12-03', time: '11:08', location: 'æ˜¥é§’å£½å¸ æœ¬åº—', text: 'åˆé¤ï¼šæ˜¥é§’å£½å¸', completed: false },
                { id: 92, date: '2025-12-03', time: '12:29', location: 'å¤©ç¥æ©‹ç­‹å•†åº—è¡—', text: 'é€›æ—¥æœ¬æœ€é•·å•†åº—è¡—', completed: false },
                { id: 93, date: '2025-12-03', time: '13:52', location: 'å››å¤©ç‹å¯º', text: 'åƒè§€å››å¤©ç‹å¯º', completed: false },
                { id: 94, date: '2025-12-03', time: '14:32', location: 'å €è¶Šç¥ç¤¾', text: 'åƒè§€å €è¶Šç¥ç¤¾', completed: false },
                { id: 95, date: '2025-12-03', time: '15:20', location: 'é£›ç”°æ–°åœ°', text: 'åƒè§€/é–’é€› (è¨»: æ­¤åœ°é»è«‹è‡ªè¡Œæ–Ÿé…Œ)', completed: false },
                { id: 96, date: '2025-12-03', time: '16:29', location: 'é€šå¤©é–£', text: 'åƒè§€é€šå¤©é–£', completed: false },
                { id: 97, date: '2025-12-03', time: '17:32', location: 'æ–°ä¸–ç•Œå¸‚å ´', text: 'é€›å¸‚å ´', completed: false },
                { id: 98, date: '2025-12-03', time: '18:52', location: 'å¤©ç‹å¯ºå…¬åœ’', text: 'æ•£æ­¥/æ™šé¤', completed: false },
                { id: 99, date: '2025-12-03', time: '21:15', location: 'é©šå®‰æ®¿å ‚å”å‰è¨¶å¾·é›£æ³¢åƒæ—¥å‰åº—', text: 'è³¼ç‰©', completed: false },
                { id: 100, date: '2025-12-03', time: '22:27', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'å›é£¯åº—ä¼‘æ¯', completed: false },

                // Day 8 (2025-12-04) - è‡¨ç©ºåŸ, è¿”ç¨‹
                { id: 101, date: '2025-12-04', time: '08:00', location: 'é›£æ³¢èˆ¹èˆ¶æ—…é¤¨', text: 'é€€æˆ¿ï¼Œæº–å‚™å‰å¾€æ©Ÿå ´', completed: false },
                { id: 102, date: '2025-12-04', time: '11:57', location: 'è‡¨ç©ºåŸ', text: 'æŠµé”è‡¨ç©ºåŸ', completed: false },
                { id: 103, date: '2025-12-04', time: '12:10', location: 'ã‚Šã‚“ãã†ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ', text: 'è‡¨ç©ºåŸ Premium Outlet è³¼ç‰©/åˆé¤', completed: false },
                { id: 104, date: '2025-12-04', time: '14:58', location: 'è‡¨ç©ºåŸ', text: 'é›¢é–‹è‡¨ç©ºåŸ', completed: false },
                { id: 105, date: '2025-12-04', time: '15:38', location: 'KIXÂ·é—œè¥¿åœ‹éš›æ©Ÿå ´', text: 'æŠµé”é—œè¥¿åœ‹éš›æ©Ÿå ´ï¼Œæº–å‚™ç™»æ©Ÿ', completed: false },
                { id: 106, date: '2025-12-04', time: '22:35', location: 'HKGÂ·é¦™æ¸¯åœ‹éš›æ©Ÿå ´', text: 'æŠµé”é¦™æ¸¯åœ‹éš›æ©Ÿå ´', completed: false },
            ];
        }

        /**
         * å¾ localStorage è¼‰å…¥è¡Œç¨‹åˆ—è¡¨ã€‚å¦‚æœæœ¬åœ°å„²å­˜ä¸­æ²’æœ‰è³‡æ–™ï¼Œå‰‡è¼‰å…¥é è¨­è¡Œç¨‹ã€‚
         * @returns {Array<Object>} è¡Œç¨‹é™£åˆ—ã€‚
         */
        function getTodos() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) {
                    return JSON.parse(data);
                } else {
                    // å¦‚æœæ²’æœ‰å„²å­˜çš„è³‡æ–™ï¼Œè¼‰å…¥é è¨­è¡Œç¨‹ä¸¦å„²å­˜åˆ°æœ¬åœ°
                    const defaultItinerary = getDefaultItinerary();
                    // ç”±æ–¼ saveTodos æœƒè§¸ç™¼ renderTodosï¼Œé€™è£¡ä¸éœ€è¦å†æ¬¡å‘¼å« renderTodos
                    // ç¢ºä¿ saveTodos å‡½æ•¸åœ¨ getDefaultItinerary ä¹‹å¾Œå®šç¾©ï¼Œæˆ–è€…åƒä¸‹é¢é€™æ¨£è™•ç†ï¼š
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultItinerary)); 
                    return defaultItinerary;
                }
            } catch (error) {
                console.error("è¼‰å…¥è¡Œç¨‹å¤±æ•—:", error);
                return [];
            }
        }

        /**
         * å°‡è¡Œç¨‹åˆ—è¡¨å„²å­˜åˆ° localStorageã€‚
         * @param {Array<Object>} todos - è¡Œç¨‹é™£åˆ—ã€‚
         */
        function saveTodos(todos) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
                // å„²å­˜å¾Œç«‹å³é‡æ–°æ¸²æŸ“ UI
                renderTodos(); 
            } catch (error) {
                console.error("å„²å­˜è¡Œç¨‹å¤±æ•—:", error);
                alertModal("éŒ¯èª¤", "ç„¡æ³•å„²å­˜è³‡æ–™ï¼Œæœ¬åœ°å„²å­˜ç©ºé–“å¯èƒ½å·²æ»¿ã€‚");
            }
        }

        // --- 2. æ‡‰ç”¨ç¨‹å¼åŠŸèƒ½é‚è¼¯ ---

        /**
         * æ ¼å¼åŒ–æ—¥æœŸå­—ä¸²ç‚ºæ˜“è®€æ ¼å¼ (MM/DD)ã€‚
         * @param {string} dateString - YYYY-MM-DD æ ¼å¼çš„æ—¥æœŸå­—ä¸²ã€‚
         * @returns {string} æ ¼å¼åŒ–å¾Œçš„æ—¥æœŸå­—ä¸²ã€‚
         */
        function formatDisplayDate(dateString) {
            if (!dateString) return 'æœªå®šæ—¥æœŸ';
            const [year, month, day] = dateString.split('-');
            const today = new Date().toISOString().slice(0, 10);
            const isToday = dateString === today;
            
            return `${month}/${day}` + (isToday ? ' (ä»Šå¤©)' : '');
        }
        
        /**
         * å˜—è©¦æ‰“é–‹åœ°åœ–æˆ–é€£çµã€‚
         * @param {string} location - åœ°é»åç¨±æˆ– URLã€‚
         */
        function openMap(location) {
            if (!location) {
                alertModal("è­¦å‘Š", "æ­¤è¡Œç¨‹æ²’æœ‰æä¾›åœ°é»æˆ–é€£çµã€‚");
                return;
            }

            let url = location.trim();
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„ URL
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                // å¦‚æœä¸æ˜¯ URLï¼Œå‰‡å‡è¨­ç‚ºåœ°é»åç¨±ï¼Œä½¿ç”¨ Google Maps æœå°‹
                url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
            }

            try {
                window.open(url, '_blank');
            } catch (e) {
                 alertModal("éŒ¯èª¤", "ç„¡æ³•æ‰“é–‹é€£çµï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç€è¦½å™¨è¨­å®šã€‚");
            }
        }


        /**
         * æ¸²æŸ“è¡Œç¨‹åˆ—è¡¨åˆ° UI ä¸Šã€‚
         */
        function renderTodos() {
            loadingMessageEl.style.display = 'none'; // éš±è—è¼‰å…¥è¨Šæ¯
            let todos = getTodos();
            todoListContainer.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

            // æ’åºï¼š1. æŒ‰æ—¥æœŸ (å‡åº) 2. æŒ‰æ™‚é–“ (å‡åº) 3. æœªå®Œæˆåœ¨å‰
            todos.sort((a, b) => {
                if (a.date < b.date) return -1;
                if (a.date > b.date) return 1;
                
                if (a.time < b.time) return -1;
                if (a.time > b.time) return 1;

                return (a.completed === b.completed ? 0 : a.completed ? 1 : -1);
            });

            if (todos.length === 0) {
                todoListContainer.innerHTML = `<p class="text-center text-gray-500 p-6 border-2 border-dashed border-purple-300 rounded-xl">
                    <span class="text-2xl block mb-2">ğŸ‰</span>
                    æ‚¨çš„è¡Œç¨‹æ¸…å–®æ˜¯ç©ºçš„ï¼ç¾åœ¨å°±é–‹å§‹è¦åŠƒæ‚¨çš„ä¸‹ä¸€æ®µæ—…ç¨‹å§ã€‚
                    </p>`;
                return;
            }

            // ä½¿ç”¨ Map æ ¹æ“šæ—¥æœŸåˆ†çµ„è¡Œç¨‹
            const groupedTodos = todos.reduce((acc, todo) => {
                const dateKey = todo.date || 'ç„¡æ—¥æœŸ';
                if (!acc[dateKey]) {
                    acc[dateKey] = [];
                }
                acc[dateKey].push(todo);
                return acc;
            }, {});

            // æ¸²æŸ“åˆ†çµ„å¾Œçš„è¡Œç¨‹
            for (const dateKey in groupedTodos) {
                const dateHeader = document.createElement('div');
                const isPast = dateKey < today;
                const isToday = dateKey === today;

                dateHeader.className = `sticky top-0 z-10 p-3 rounded-lg font-extrabold text-white shadow-md transition duration-300 ${isPast ? 'bg-gray-500' : isToday ? 'bg-indigo-500' : 'bg-purple-600'}`;
                
                dateHeader.innerHTML = `<span class="text-xl">${formatDisplayDate(dateKey)}</span> <span class="text-sm font-normal ml-2">${isPast ? '(å·²éæœŸ)' : isToday ? '(ä»Šæ—¥ç„¦é»)' : ''}</span>`;
                todoListContainer.appendChild(dateHeader);

                groupedTodos[dateKey].forEach(todo => {
                    const todoItem = document.createElement('div');
                    const isCompleted = todo.completed;

                    todoItem.className = `flex flex-col sm:flex-row items-start sm:items-center justify-between p-5 rounded-xl border-l-4 my-3 transition duration-150 ease-in-out cursor-pointer ${isCompleted ? 'bg-green-50 border-green-400 text-gray-500 opacity-70' : 'bg-white border-purple-400 hover:shadow-lg'}`;
                    
                    const contentArea = document.createElement('div');
                    contentArea.className = 'flex-grow mb-3 sm:mb-0';
                    
                    // æ™‚é–“å’Œåœ°é»
                    const metaData = document.createElement('div');
                    metaData.className = 'text-sm mb-1 space-x-4 flex items-center';
                    metaData.innerHTML = `
                        <span class="font-mono text-purple-600 ${isCompleted ? 'text-gray-400' : ''}">
                            <svg class="w-4 h-4 inline mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            ${todo.time || 'å…¨å¤©'}
                        </span>
                        ${todo.location ? `<span class="text-gray-500 ${isCompleted ? 'text-gray-400' : ''} flex items-center">
                            <svg class="w-4 h-4 inline mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            ${todo.location}
                        </span>` : ''}
                    `;
                    contentArea.appendChild(metaData);

                    // è¡Œç¨‹å…§å®¹
                    const mainText = document.createElement('p');
                    mainText.className = `text-lg font-medium ${isCompleted ? 'line-through text-gray-500' : 'text-gray-800'}`;
                    mainText.textContent = todo.text;
                    contentArea.appendChild(mainText);

                    todoItem.appendChild(contentArea);
                    
                    // æŒ‰éˆ•å®¹å™¨
                    const buttonGroup = document.createElement('div');
                    buttonGroup.className = 'flex space-x-2 flex-shrink-0';
                    
                    // å°èˆªæŒ‰éˆ•
                    const navigateBtn = document.createElement('button');
                    navigateBtn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l4-4m4 4l4-4m-4 4V5a2 2 0 00-2-2h-2a2 2 0 00-2 2v10m-2 4h4"></path></svg>`;
                    navigateBtn.title = 'å‰å¾€å°èˆª/é€£çµ';
                    navigateBtn.className = 'p-2 rounded-full bg-blue-500 hover:bg-blue-600 text-white shadow-md transition duration-150';
                    navigateBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); // é˜²æ­¢é»æ“Šäº‹ä»¶å½±éŸ¿çˆ¶å…ƒç´ ï¼ˆå®Œæˆåˆ‡æ›ï¼‰
                        openMap(todo.location);
                    });

                    // å®ŒæˆæŒ‰éˆ•
                    const completeBtn = document.createElement('button');
                    completeBtn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${isCompleted ? 'M6 18L18 6M6 6l12 12' : 'M5 13l4 4L19 7'}"></path></svg>`;
                    completeBtn.title = isCompleted ? 'æ¨™è¨˜ç‚ºæœªå®Œæˆ' : 'æ¨™è¨˜ç‚ºå®Œæˆ';
                    completeBtn.className = `p-2 rounded-full ${isCompleted ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'} text-white shadow-md transition duration-150`;
                    completeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleComplete(todo.id);
                    });

                    // åˆªé™¤æŒ‰éˆ•
                    const deleteBtn = document.createElement('button');
                    deleteBtn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>`;
                    deleteBtn.title = 'åˆªé™¤è¡Œç¨‹';
                    deleteBtn.className = 'p-2 rounded-full bg-gray-400 hover:bg-gray-500 text-white shadow-md transition duration-150';
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteTodo(todo.id);
                    });

                    if(todo.location) buttonGroup.appendChild(navigateBtn);
                    buttonGroup.appendChild(completeBtn);
                    buttonGroup.appendChild(deleteBtn);
                    
                    todoItem.appendChild(buttonGroup);
                    todoListContainer.appendChild(todoItem);
                });
            }
        }

        /**
         * æ–°å¢è¡Œç¨‹ã€‚
         */
        function addTodo() {
            const text = newTodoTextEl.value.trim();
            const date = newTodoDateEl.value; 
            const time = newTodoTimeEl.value;
            const location = newTodoLocationEl.value.trim();

            if (text === '') return alertModal("è­¦å‘Š", "è¡Œç¨‹å…§å®¹ä¸èƒ½ç‚ºç©ºï¼");
            if (date === '') return alertModal("è­¦å‘Š", "è«‹é¸æ“‡è¡Œç¨‹æ—¥æœŸï¼");

            addTodoBtn.disabled = true;
            addTodoBtn.innerHTML = '<span class="animate-pulse">å„²å­˜ä¸­...</span>';

            const todos = getTodos();
            const newTodo = {
                id: Date.now(), 
                text: text,
                date: date,
                time: time,
                location: location,
                completed: false
            };

            todos.push(newTodo);
            saveTodos(todos); 
            
            // æ¸…ç©ºå…§å®¹å’Œåœ°é»ï¼Œæ—¥æœŸå’Œæ™‚é–“ä¿æŒä¸è®Šæ–¹ä¾¿é€£çºŒè¼¸å…¥
            newTodoTextEl.value = ''; 
            newTodoLocationEl.value = '';

            addTodoBtn.innerHTML = '<svg class="w-5 h-5 inline mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>æ–°å¢';
            addTodoBtn.disabled = false;
        }

        /**
         * åˆ‡æ›è¡Œç¨‹çš„å®Œæˆç‹€æ…‹ã€‚
         */
        function toggleComplete(id) {
            const todos = getTodos();
            const index = todos.findIndex(todo => todo.id === id);

            if (index !== -1) {
                todos[index].completed = !todos[index].completed;
                saveTodos(todos);
            }
        }

        /**
         * åˆªé™¤è¡Œç¨‹ã€‚
         */
        function deleteTodo(id) {
            // ç”±æ–¼ç¦æ­¢ä½¿ç”¨ confirm()ï¼Œé€™è£¡ä»ä½¿ç”¨ window.confirm ä½œç‚ºå¿«é€Ÿæç¤º
            if (window.confirm("ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ")) { 
                const todos = getTodos();
                const filteredTodos = todos.filter(todo => todo.id !== id);
                saveTodos(filteredTodos);
            }
        }

        // --- 3. UI è¼”åŠ©å‡½æ•¸ ---

        /**
         * å®¢è£½åŒ–æ¨¡æ…‹æ¡†æ›¿ä»£ alert/confirmã€‚
         */
        function alertModal(title, message) {
            const existingModal = document.getElementById('custom-alert-modal');
            if (existingModal) existingModal.remove();

            const modalHtml = `
                <div id="custom-alert-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl p-8 shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100">
                        <h2 class="text-2xl font-bold mb-3 ${title.includes('è­¦å‘Š') ? 'text-yellow-600' : 'text-red-600'}">${title}</h2>
                        <p class="text-gray-700 mb-6">${message}</p>
                        <button onclick="document.getElementById('custom-alert-modal').remove()" 
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition duration-150 shadow-md">
                            æ˜ç™½äº†
                        </button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // --- 4. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ ---
        window.onload = function () {
            // åˆå§‹è¼‰å…¥å’Œæ¸²æŸ“è³‡æ–™
            renderTodos();

            // äº‹ä»¶ç›£è½å™¨
            addTodoBtn.addEventListener('click', addTodo);
            newTodoTextEl.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTodo();
                }
            });
        };

    </script>
</body>
</html>